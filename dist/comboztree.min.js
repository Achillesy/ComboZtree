/**
 * ComboZtree: A jQuery plugin for dropdown tree select.
 *
 * @name       ComboZtree jQuery Plugin
 * @author     Achilles <Achillesy@gmail.com>, Chen liguo
 * @version    0.1.0
 *
 * @requires jQuery, zTree
 *
 * Copyright (c) 2017 by Achilles
 */
(function(n,t){"use strict";var i=function(n){this.$element=n;this.isCZT=this.$element.hasClass("comboztree");this.isUp=this.$element.hasClass("dropup");this.isMulti=this.$element.hasClass("multiselect");this.elementID=this.$element.attr("id");this.inputID=this.elementID+"_input";this.dropdownID=this.elementID+"_dropdown";this.menuID=this.elementID+"_menu";this.ztreeID=this.elementID+"_ztree";this.mouseInside=!0};i.prototype={init:function(i,r){var u=this,h=n("#"+u.elementID).width(),c=n("#"+u.elementID).height(),e,o,f,s;n("#"+u.elementID).hide();e="";u.isUp&&(e="dropup");o='<div class="input-group"><input type="text" class="form-control" readonly="true" id="'+u.inputID+'"><div class="input-group-btn '+e+'"><button type="button" class="btn btn-default dropdown-toggle" id="'+u.dropdownID+'"><span class="caret"><\/span><\/button><div class="dropdown-menu dropdown-menu-right" id="'+u.menuID+'"><ul class="ztree" id="'+u.ztreeID+'"><\/ul><\/div><\/div><\/div>';n(o).insertAfter(u.$element);n("#"+u.menuID).css("width",n("#"+u.elementID).width()+24);f={};u.isMulti?(f.check={enable:!0,chkboxType:{Y:"",N:""}},f.view={dblClickExpand:!1,nameIsHTML:!1},f.callback={beforeClick:function(t,i){var r=n.fn.zTree.getZTreeObj(u.ztreeID);return r.checkNode(i,!i.checked,null,!0),!1},onClick:null,onCheck:function(){for(var e=n.fn.zTree.getZTreeObj(u.ztreeID),f=e.getCheckedNodes(!0),t="",i="",r=0,o=f.length;r<o;r++)t+=f[r].name+",",i+=f[r].id+",";t.length>0&&(t=t.substring(0,t.length-1));i.length>0&&(i=i.substring(0,i.length-1));n("#"+u.inputID).attr("value",t);n("#"+u.elementID).attr("value",i)}}):(f.view={dblClickExpand:!1,nameIsHTML:!1},f.callback={beforeClick:null,onClick:function(t,i,r){n("#"+u.inputID).attr("value",r.name);n("#"+u.elementID).attr("value",r.id);n("#"+u.menuID).hide();this.mouseInside=!0},onCheck:null});s=n.extend(!0,{},i,f);n.fn.zTree.init(n("#"+u.ztreeID),s,r);n("#"+u.dropdownID).click(function(){n("#"+u.menuID).toggle()});n(t).on("resize",function(){n("#"+u.menuID).css("width",n("#"+u.elementID).width()+24)});return n("#"+u.menuID).mouseenter(function(){u.mouseInside=!0}),n("#"+u.menuID).mouseleave(function(){u.mouseInside=!1}),n(t).click(function(){u.mouseInside||(n("#"+u.menuID).hide(),u.mouseInside=!0)}),u.$element},disabled:function(t){var i=this;return n("#"+i.dropdownID).attr("disabled",t),this.$element},tree:function(){return n.fn.zTree.getZTreeObj(this.ztreeID)},reload:function(){return alert("reload"),this.$element},clear:function(){return alert("clear"),this.$element},setValue:function(t){var r=n.fn.zTree.getZTreeObj(this.ztreeID),i=r.getNodeByParam("id",t,null);return i!=null?(r.selectNode(i,!1,!1),n("#"+this.inputID).attr("value",i.name),n("#"+this.elementID).attr("value",i.id)):(n("#"+this.inputID).attr("value",null),n("#"+this.elementID).attr("value",null)),this.$element},getValue:function(){return n("#"+this.elementID).val()},setValues:function(t){for(var o,f=n.fn.zTree.getZTreeObj(this.ztreeID),i=0,e=t.length;i<e;i++)o=f.getNodeByParam("id",t[i],null),o!=null&&f.checkNode(o,!0,!0);var s=f.getCheckedNodes(!0),r="",u="";for(i=0,e=s.length;i<e;i++)r+=s[i].name+",",u+=s[i].id+",";return r.length>0&&(r=r.substring(0,r.length-1)),u.length>0&&(u=u.substring(0,u.length-1)),n("#"+this.inputID).attr("value",r),n("#"+this.elementID).val(u),this.$element},getValues:function(){return n("#"+this.elementID).val()}};n.fn.ComboZtree=function(n,t,r){var u=new i(this);return u.isCZT?n=="init"?u.init(t,r):n=="disabled"?u.disabled(t):n=="tree"?u.tree():n=="reload"?u.reload():n=="clear"?u.clear():n=="setValue"?u.setValue(t):n=="getValue"?u.getValue():n=="setValues"?u.setValues(t):n=="getValues"?u.getValues():this:this}})(jQuery,window,document)